name: Advanced Pinterest Savings Automation

on:
  schedule:
    # GÃ¼nde 2 kez - Optimal saatler
    - cron: '0 9 * * *'    # 12:00 TR - Ã–ÄŸle
    - cron: '0 15 * * *'   # 18:00 TR - AkÅŸam
  workflow_dispatch:
  push:
    branches: [ main, master ]

jobs:
  pinterest-savings:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install Dependencies
      run: |
        pip install requests
    
    - name: Generate & Post Premium Savings Content
      env:
        IFTTT_KEY: dpnyddbPNFiOv6CVml5Lkc
        WEBSITE_URL: https://digitalpiggybank.app
      run: |
        python << 'EOF'
        import requests
        import random
        import os
        import json
        from datetime import datetime
        import urllib.parse
        import hashlib

        # ============================================
        # GELÄ°ÅžMÄ°Åž TASARRUF PROMPT HAVUZU
        # ============================================
        
        content_library = {
            "piggy_bank_cute": {
                "scenes": [
                    "adorable pink ceramic piggy bank with gold coins scattered around, cozy home setting",
                    "cute pastel colored piggy bank on wooden desk with Turkish Lira bills, aesthetic flat lay",
                    "kawaii style piggy bank character with happy face, surrounded by shiny coins",
                    "minimalist white piggy bank on marble surface, modern clean aesthetic",
                    "vintage brass piggy bank with patina, nostalgic savings concept",
                    "transparent glass piggy bank filled with colorful coins, see-through savings",
                    "modern geometric piggy bank design in metallic gold, luxury savings concept",
                    "handmade ceramic piggy bank with floral patterns, artisan craft aesthetic"
                ],
                "titles": [
                    "ðŸ’° Her GÃ¼n Biraz Daha ZenginleÅŸ",
                    "ðŸŽ¯ Hedefine UlaÅŸmanÄ±n SÄ±rrÄ±",
                    "âœ¨ KÃ¼Ã§Ã¼k AdÄ±mlar, BÃ¼yÃ¼k BaÅŸarÄ±lar",
                    "ðŸŒŸ Tasarruf YolculuÄŸuna BaÅŸla",
                    "ðŸ’Ž Hayallerini GerÃ§eÄŸe DÃ¶nÃ¼ÅŸtÃ¼r",
                    "ðŸ† Finansal Ã–zgÃ¼rlÃ¼k Rehberin",
                    "ðŸ’ GeleceÄŸin Ä°Ã§in BugÃ¼n Biriktir",
                    "ðŸš€ BaÅŸarÄ± Hikayeni Burada BaÅŸlÄ±yor"
                ]
            },
            
            "money_growth": {
                "scenes": [
                    "stack of gold coins growing like stairs towards the sky, success journey metaphor",
                    "Turkish Lira bills arranged in ascending order, wealth building visualization",
                    "plant growing from pile of coins, money tree concept, nature meets finance",
                    "rising graph made of coins and bills, financial growth illustration",
                    "golden coins flowing upward in spiral, abundance and prosperity",
                    "savings jar filling up with coins progressively, step by step growth",
                    "calculator and growing coin stacks on desk, financial planning aesthetic",
                    "hands carefully stacking coins higher, patient wealth building"
                ],
                "titles": [
                    "ðŸ“ˆ Her Ay BÃ¼yÃ¼yen Birikimin",
                    "ðŸ’ª KararlÄ±lÄ±k + Disiplin = BaÅŸarÄ±",
                    "ðŸŽ‰ Hedefine %50 Daha YaklaÅŸtÄ±n",
                    "â° Zamanla BÃ¼yÃ¼yen Servetin",
                    "ðŸŒ± Para AÄŸacÄ±nÄ± BugÃ¼n Dik",
                    "ðŸ“Š Ä°statistikler Yalan SÃ¶ylemez",
                    "ðŸ”¥ Momentum Kaybetme, Devam Et",
                    "ðŸ’¯ TutarlÄ±lÄ±k AnahtarÄ± GÃ¶sterecek"
                ]
            },
            
            "goal_achievement": {
                "scenes": [
                    "golden target with arrow hitting bullseye, achievement and goal success",
                    "milestone markers along path with coins, journey to financial goal",
                    "trophy filled with gold coins, victory in savings challenge",
                    "checklist with golden checkmarks and coins, completed savings goals",
                    "mountain peak made of coins with flag on top, summit of success",
                    "keys to new car/house with coins around, dream achievement visualization",
                    "calendar marked with savings milestones, time-based goal tracking",
                    "progress bar filling up with gold, visual goal completion"
                ],
                "titles": [
                    "ðŸŽ¯ Araba Hayalin GerÃ§ek Oluyor",
                    "ðŸ  Ev Sahibi OlmanÄ±n Ä°lk AdÄ±mÄ±",
                    "âœˆï¸ Seyahat Fonun HazÄ±r",
                    "ðŸ’ DÃ¼ÄŸÃ¼n BÃ¼tÃ§en TamamlanÄ±yor",
                    "ðŸ“š EÄŸitim YatÄ±rÄ±mÄ±n BaÅŸladÄ±",
                    "ðŸŽ“ Ã‡ocuklarÄ±nÄ±n GeleceÄŸi GÃ¼vende",
                    "ðŸš— Hayalindeki Araca KavuÅŸuyorsun",
                    "ðŸŒ´ Tatil Fonu Doldu"
                ]
            },
            
            "motivational_quotes": {
                "scenes": [
                    "inspiring quote on minimalist background with subtle coin imagery",
                    "motivational text overlay on gold gradient, elegant typography",
                    "wisdom words with piggy bank silhouette, philosophical savings concept",
                    "powerful quote with Turkish Lira symbol, financial motivation",
                    "success mantra with coin rain effect, abundance mindset",
                    "daily affirmation with golden frame, positive money mindset",
                    "inspirational message with growing plant metaphor, patience pays",
                    "encouraging words with sunrise and coins, new beginning energy"
                ],
                "titles": [
                    "ðŸ’­ 'BugÃ¼n BiriktirdiÄŸin, YarÄ±nÄ±n Ã–zgÃ¼rlÃ¼ÄŸÃ¼'",
                    "ðŸŒŸ 'KÃ¼Ã§Ã¼k Paralar, BÃ¼yÃ¼k Hayaller'",
                    "âœ¨ 'Disiplin GeÃ§icidir, SonuÃ§lar KalÄ±cÄ±dÄ±r'",
                    "ðŸ’ª 'Sen Yapabilirsin, Ä°statistikler YanÄ±nda'",
                    "ðŸŽ¯ 'Hedef Koymak Kolay, UlaÅŸmak Disiplin Ä°ster'",
                    "ðŸ”¥ 'Her â‚º1 Sayar, Her GÃ¼n Ã–nemli'",
                    "ðŸŒˆ 'SabÄ±r + TutarlÄ±lÄ±k = BaÅŸarÄ±'",
                    "ðŸ’Ž 'BugÃ¼nkÃ¼ FedakarlÄ±k, YarÄ±nÄ±n Konfor'"
                ]
            },
            
            "lifestyle_dreams": {
                "scenes": [
                    "vision board with dream house, car, travel destinations and coins",
                    "luxury items (watch, car keys, house model) with savings concept",
                    "family vacation photo memories with piggy bank, life goals",
                    "peaceful retirement scene with financial security symbols",
                    "modern minimalist home interior with wealth indicators",
                    "business success celebration with financial freedom theme",
                    "wedding planning items with savings tracker, life milestones",
                    "education graduation cap with diploma and coins, investment in future"
                ],
                "titles": [
                    "ðŸ¡ Hayalinizdeki Ev YakÄ±nda",
                    "ðŸš˜ Yeni Araban Seni Bekliyor",
                    "âœˆï¸ DÃ¼nya Turuna Ã‡Ä±kmaya HazÄ±r mÄ±sÄ±n?",
                    "ðŸ’’ RÃ¼ya Gibi DÃ¼ÄŸÃ¼n Ä°Ã§in Plan",
                    "ðŸŽ“ EÄŸitime YatÄ±rÄ±m En BÃ¼yÃ¼k KazanÃ§",
                    "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Ailenin GeleceÄŸi GÃ¼vende",
                    "ðŸŒ… Erken Emeklilik ArtÄ±k MÃ¼mkÃ¼n",
                    "ðŸ’¼ Kendi Ä°ÅŸinin Patronu OlacaksÄ±n"
                ]
            },
            
            "smart_strategies": {
                "scenes": [
                    "infographic style layout showing 52-week savings challenge",
                    "monthly budget planner with coins and calculator, organization",
                    "smartphone app showing savings tracker, modern digital finance",
                    "envelope budgeting system with Turkish Lira, traditional method",
                    "investment diversification chart with piggy bank, smart money",
                    "automatic savings transfer illustration, passive income concept",
                    "financial literacy books with coins, education and growth",
                    "comparison chart showing savings growth over time, data visualization"
                ],
                "titles": [
                    "ðŸ“± Otomatik Tasarruf Sistemi Kur",
                    "ðŸ’¡ 52 Hafta Challenge ile â‚º13,780",
                    "ðŸ§  AkÄ±llÄ± Birikim Stratejileri",
                    "ðŸ“Š BÃ¼tÃ§e PlanÄ± ile Hedefe KoÅŸ",
                    "ðŸŽ¯ KÃ¼Ã§Ã¼k TÃ¼yolar, BÃ¼yÃ¼k Farklar",
                    "ðŸ’° GÃ¼nde â‚º10 = YÄ±lda â‚º3,650",
                    "ðŸ” Acil Durum Fonu OluÅŸtur",
                    "ðŸ“ˆ BileÅŸik Faizin GÃ¼cÃ¼"
                ]
            }
        }

        # ============================================
        # HEDEF KATEGORÄ°LERÄ°
        # ============================================
        
        popular_goals = {
            "vehicles": ["araba", "otomobil", "motorsiklet", "bisiklet", "elektrikli scooter"],
            "housing": ["ev", "daire", "villa", "arsa", "ev eÅŸyasÄ±", "mobilya"],
            "travel": ["tatil", "seyahat", "dÃ¼nya turu", "yurt dÄ±ÅŸÄ±", "balayÄ±"],
            "education": ["eÄŸitim", "kurs", "dil Ã¶ÄŸrenimi", "Ã¼niversite", "yÃ¼ksek lisans"],
            "wedding": ["dÃ¼ÄŸÃ¼n", "niÅŸan", "evlilik", "Ã§eyiz"],
            "technology": ["telefon", "laptop", "kamera", "oyun konsolu", "tablet"],
            "investments": ["yatÄ±rÄ±m", "hisse senedi", "altÄ±n", "kripto", "giriÅŸim"],
            "emergency": ["acil fon", "saÄŸlÄ±k", "sigorta", "gÃ¼venlik", "yedek para"]
        }
        
        all_goals = [goal for category in popular_goals.values() for goal in category]

        # ============================================
        # GÃ–RSEL ENHANCEMENT
        # ============================================
        
        visual_styles = [
            "professional photography, natural lighting, shallow depth of field, 8k resolution",
            "lifestyle photography, warm golden hour, authentic moment, high quality",
            "modern minimalist aesthetic, clean bright atmosphere, professional composition",
            "cozy indoor scene, soft window light, intimate comfortable setting, magazine worthy",
            "studio quality portrait, perfect lighting, commercial grade photography",
            "flat lay composition, overhead shot, perfectly arranged, Instagram aesthetic",
            "bokeh background, dreamy atmosphere, professional color grading",
            "vibrant colors, high contrast, editorial style, premium quality",
            "soft pastel tones, gentle lighting, elegant composition, Pinterest popular",
            "dramatic lighting, cinematic feel, high-end production quality"
        ]
        
        artistic_styles = [
            "watercolor illustration style", "digital art aesthetic", "3D render style",
            "minimalist vector art", "hand-drawn sketch style", "modern infographic design",
            "gradient geometric design", "paper craft aesthetic", "vintage poster style"
        ]
        
        emotional_tones = [
            "inspiring and motivational", "calm and peaceful", "joyful and optimistic",
            "confident and empowering", "warm and inviting", "luxurious and aspirational",
            "energetic and dynamic", "sophisticated and elegant", "playful and fun"
        ]

        # ============================================
        # AKILLI Ä°Ã‡ERÄ°K SEÃ‡Ä°MÄ°
        # ============================================
        
        current_hour = datetime.now().hour
        
        if 6 <= current_hour < 12:
            # Sabah: Motivasyonel, enerji
            category_weights = {
                "motivational_quotes": 0.3,
                "smart_strategies": 0.3,
                "money_growth": 0.2,
                "goal_achievement": 0.2
            }
        elif 12 <= current_hour < 18:
            # Ã–ÄŸle: Bilgilendirici, pratik
            category_weights = {
                "smart_strategies": 0.4,
                "money_growth": 0.3,
                "piggy_bank_cute": 0.2,
                "lifestyle_dreams": 0.1
            }
        else:
            # AkÅŸam: Duygusal, hayal kurma
            category_weights = {
                "lifestyle_dreams": 0.3,
                "goal_achievement": 0.3,
                "piggy_bank_cute": 0.2,
                "motivational_quotes": 0.2
            }
        
        categories = list(category_weights.keys())
        weights = list(category_weights.values())
        selected_category = random.choices(categories, weights=weights)[0]
        
        content = content_library[selected_category]
        
        # Hedef seÃ§imi
        goal = random.choice(all_goals)

        # ============================================
        # PROMPT ENGÄ°NEERÄ°NG
        # ============================================
        
        scene = random.choice(content["scenes"])
        
        # Rastgele stil karÄ±ÅŸÄ±mÄ±
        if random.random() < 0.7:
            style = random.choice(visual_styles)
        else:
            style = random.choice(artistic_styles)
        
        tone = random.choice(emotional_tones)
        
        master_prompt = (
            f"{scene}, "
            f"{style}, "
            f"{tone} mood, "
            f"Turkish savings and finance theme, "
            f"no text overlays, no watermarks, no logos, "
            f"clean professional aesthetic, "
            f"Pinterest optimized, vertical format"
        )
        
        print(f"ðŸŽ¨ Kategori: {selected_category}")
        print(f"ðŸŽ¯ Hedef: {goal}")
        print(f"ðŸ“¸ Prompt: {master_prompt[:120]}...")

        # ============================================
        # GÃ–RSEL OLUÅžTURMA
        # ============================================
        
        encoded_prompt = urllib.parse.quote(master_prompt)
        
        # Benzersiz seed
        timestamp = int(datetime.now().timestamp())
        random_factor = random.randint(1, 999999)
        prompt_hash = int(hashlib.md5(master_prompt.encode()).hexdigest()[:8], 16)
        unique_seed = (timestamp + random_factor + prompt_hash) % 1000000
        
        # Pinterest optimal boyutlar
        dimensions_options = [
            {"width": 1000, "height": 1500, "ratio": "2:3"},
            {"width": 1080, "height": 1620, "ratio": "2:3"},
            {"width": 1000, "height": 1400, "ratio": "5:7"}
        ]
        
        dimensions = random.choice(dimensions_options)
        
        image_url = (
            f"https://image.pollinations.ai/prompt/{encoded_prompt}"
            f"?width={dimensions['width']}"
            f"&height={dimensions['height']}"
            f"&seed={unique_seed}"
            f"&nologo=true"
            f"&enhance=true"
            f"&model=flux"
        )
        
        print(f"ðŸ–¼ï¸  Boyut: {dimensions['width']}x{dimensions['height']} ({dimensions['ratio']})")
        print(f"ðŸ”¢ Seed: {unique_seed}")

        # ============================================
        # SEO-OPTÄ°MÄ°ZE Ä°Ã‡ERÄ°K
        # ============================================
        
        title = random.choice(content["titles"])
        
        # Premium hashtag stratejisi
        core_hashtags = ["#tasarruf", "#birikim", "#parabirikimi", "#hedef"]
        
        trending_hashtags = [
            "#finansalÃ¶zgÃ¼rlÃ¼k", "#parayÃ¶netimi", "#bÃ¼tÃ§e", "#yatÄ±rÄ±m",
            "#baÅŸarÄ±", "#motivasyon", "#hedeflerim", "#zenginlik",
            "#akÄ±llÄ±tasarruf", "#gelecek", "#hayaller", "#baÄŸÄ±msÄ±zlÄ±k"
        ]
        
        goal_hashtags = [
            f"#{goal.replace(' ', '')}", "#hedefimvar", "#hayalkur",
            "#baÅŸarÄ±hikayesi", "#ilerleme", "#azimvekararlÄ±lÄ±k"
        ]
        
        lifestyle_hashtags = [
            "#yaÅŸamtarzÄ±", "#minimalizm", "#bilinÃ§litÃ¼ketim",
            "#finansaleÄŸitim", "#kiÅŸiselgeliÅŸim", "#baÅŸarÄ±motivasyonu"
        ]
        
        # Hashtag kombinasyonu
        selected_hashtags = (
            core_hashtags +
            random.sample(trending_hashtags, 6) +
            random.sample(goal_hashtags, 3) +
            random.sample(lifestyle_hashtags, 3)
        )
        
        # Ã‡ekici aÃ§Ä±klamalar
        descriptions = [
            f"ðŸ’° {goal.upper()} hedefine adÄ±m adÄ±m yaklaÅŸÄ±yorsun! KÃ¼Ã§Ã¼k birikimlerin bÃ¼yÃ¼k hayallere dÃ¶nÃ¼ÅŸÃ¼yor. Sen de bu baÅŸarÄ± hikayesinin bir parÃ§asÄ± ol!",
            
            f"ðŸŽ¯ Hedefin {goal} mÄ±? MÃ¼kemmel! GÃ¼nde sadece kÃ¼Ã§Ã¼k bir miktar biriktirerek hayallerini gerÃ§ekleÅŸtirebilirsin. BaÅŸarÄ± hikayeni ÅŸimdi baÅŸlÄ±yor!",
            
            f"âœ¨ {goal} iÃ§in birikim yapmak hiÃ§ bu kadar kolay olmamÄ±ÅŸtÄ±! Otomatik hatÄ±rlatmalar, ilerleme takibi ve motivasyon - hepsi Ã¼cretsiz!",
            
            f"ðŸš€ {goal.capitalize()} hayalin artÄ±k Ã§ok yakÄ±n! AkÄ±llÄ± tasarruf stratejileri ve disiplinli birikim ile hedefe ulaÅŸ. Sen de yapabilirsin!",
            
            f"ðŸ’Ž Her bÃ¼yÃ¼k baÅŸarÄ± kÃ¼Ã§Ã¼k adÄ±mlarla baÅŸlar. {goal} iÃ§in bugÃ¼n attÄ±ÄŸÄ±n kÃ¼Ã§Ã¼k adÄ±mlar yarÄ±nÄ±n bÃ¼yÃ¼k baÅŸarÄ±sÄ± olacak!"
        ]
        
        cta_options = [
            "ðŸ‘‰ Ãœcretsiz baÅŸla, hedefine ulaÅŸ!",
            "ðŸ“± Hemen kaydol, ilk adÄ±mÄ± at!",
            "ðŸŽ Tamamen Ã¼cretsiz, sÄ±nÄ±rsÄ±z kullanÄ±m!",
            "â­ 10,000+ mutlu kullanÄ±cÄ±ya katÄ±l!",
            "ðŸ”¥ Åžimdi baÅŸla, yarÄ±n teÅŸekkÃ¼r et!"
        ]
        
        final_description = (
            f"{random.choice(descriptions)}\n\n"
            f"{random.choice(cta_options)}\n"
            f"ðŸ”— {os.environ.get('WEBSITE_URL', 'https://digitalpiggybank.app')}\n\n"
            f"{' '.join(selected_hashtags)}"
        )

        # ============================================
        # PINTEREST'E GÃ–NDER
        # ============================================
        
        ifttt_url = f"https://maker.ifttt.com/trigger/savings_update/with/key/{os.environ['IFTTT_KEY']}"
        
        payload = {
            "value1": image_url,
            "value2": title,
            "value3": final_description
        }
        
        print(f"\nðŸ“Œ PINTEREST'E GÃ–NDERÄ°LÄ°YOR")
        print(f"BaÅŸlÄ±k: {title}")
        print(f"AÃ§Ä±klama: {final_description[:100]}...")
        print(f"GÃ¶rsel: {image_url[:80]}...")
        
        response = requests.post(ifttt_url, json=payload, timeout=30)
        
        if response.status_code == 200:
            print(f"\nâœ… BAÅžARILI! Pin Pinterest'te yayÄ±nlandÄ±")
            print(f"ðŸŽ¯ Kategori: {selected_category}")
            print(f"ðŸŽ¨ Hedef: {goal}")
            print(f"ðŸ“Š Hashtag sayÄ±sÄ±: {len(selected_hashtags)}")
        else:
            print(f"\nâŒ HATA: {response.status_code}")
            print(f"YanÄ±t: {response.text}")
            
        # Log kaydet
        log_entry = {
            "timestamp": datetime.now().isoformat(),
            "category": selected_category,
            "goal": goal,
            "seed": unique_seed,
            "status": "success" if response.status_code == 200 else "failed"
        }
        print(f"\nðŸ“ Log: {json.dumps(log_entry, indent=2)}")
        
        EOF
    
    - name: Tamamlama Ã–zeti
      run: |
        echo "âœ… Pinterest tasarruf otomasyonu tamamlandÄ±"
        echo "â° Sonraki Ã§alÄ±ÅŸma ~6 saat sonra"
        echo "ðŸ“ˆ SÃ¼rdÃ¼rÃ¼lebilir trafik oluÅŸturuluyor"
