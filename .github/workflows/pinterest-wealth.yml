name: Advanced Pinterest Diversity Engine (Viral Text Version)

on:
  schedule:
    # Cron zamanlarƒ± GitHub Actions i√ßin UTC'dir. A≈üaƒüƒ±daki yorumlar Istanbul (+03:00) saatine g√∂re verilmi≈ütir.
    - cron: '0 8 * * *'   # 11:00 (sabah g√∂nderisi)
    - cron: '0 15 * * *'  # 18:00 (ak≈üam g√∂nderisi)
    - cron: '8 11 * * 5'     # Cuma 14:08
    - cron: '35 16 * * 6'    # Cumartesi 19:35
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  pinterest-diverse:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests pillow urllib3

    - name: Create workspace for state
      run: |
        mkdir -p .pinterest_state
        echo "State directory created at $(date)" > .pinterest_state/.init

    - name: Ultra Diverse Pinterest Content (script)
      env:
        IFTTT_KEY: ${{ secrets.IFTTT_KEY }}
        IFTTT_EVENT: ${{ secrets.IFTTT_EVENT }}
        WEBSITE_URL: https://savetracker.site/
        ACCOUNT_AGE_DAYS: 30
        STATE_DIR: .pinterest_state
      run: |
        set -euo pipefail
        python << 'PY'
        # -*- coding: utf-8 -*-
        """
        Pinterest i√ßin optimize edilmi≈ü, TEXTLI, y√ºksek kaliteli g√∂rsel promptlarƒ±
        Saving/tasarruf temasƒ±na odaklanmƒ±≈ü + Motivasyonel textler
        """
        import os
        import sys
        import time
        import json
        import random
        import hashlib
        from datetime import datetime
        import urllib.parse
        import requests
        from pathlib import Path
        from requests.adapters import HTTPAdapter
        from urllib3.util.retry import Retry

        STATE_DIR = Path(os.environ.get('STATE_DIR', '.pinterest_state'))
        STATE_DIR.mkdir(parents=True, exist_ok=True)
        POSTED_FILE = STATE_DIR / 'posted.json'

        def load_posted():
            if POSTED_FILE.exists():
                try:
                    return set(json.loads(POSTED_FILE.read_text()))
                except Exception:
                    return set()
            return set()

        def save_posted(posted_set):
            try:
                POSTED_FILE.write_text(json.dumps(list(posted_set)))
            except Exception as e:
                print(f"‚ö†Ô∏è State save failed: {e}")

        def create_session(retries=3, backoff_factor=0.6, status_forcelist=(500,502,503,504)):
            s = requests.Session()
            retry = Retry(
                total=retries,
                read=retries,
                connect=retries,
                backoff_factor=backoff_factor,
                status_forcelist=status_forcelist,
                allowed_methods=["GET","POST"]
            )
            adapter = HTTPAdapter(max_retries=retry)
            s.mount('https://', adapter)
            s.mount('http://', adapter)
            s.headers.update({'User-Agent': 'adv-pinterest-engine/2.0'})
            return s

        session = create_session()

        IFTTT_KEY = os.environ.get('IFTTT_KEY')
        IFTTT_EVENT = os.environ.get('IFTTT_EVENT') or 'pinterest_paylas'
        WEBSITE_URL = os.environ.get('WEBSITE_URL', '').strip()

        if not IFTTT_KEY:
            print('‚ùå IFTTT_KEY eksik. L√ºtfen secrets.IFTTT_KEY ekleyin.')
            sys.exit(2)

        if not WEBSITE_URL:
            print('‚ö†Ô∏è WEBSITE_URL yok. Devam ediyoruz ama description i√ßinde link olmayacak.')

        def calculate_safe_pin_count():
            account_age = int(os.environ.get('ACCOUNT_AGE_DAYS', 1))
            if account_age < 7:
                max_daily_pins = 2
            elif account_age < 14:
                max_daily_pins = 4
            elif account_age < 30:
                max_daily_pins = 8
            elif account_age < 60:
                max_daily_pins = 12
            elif account_age < 90:
                max_daily_pins = 15
            else:
                max_daily_pins = 20

            pins_today = random.randint(0, max(0, max_daily_pins - 5))
            remaining_pins = max_daily_pins - pins_today
            if remaining_pins <= 0:
                return 0
            pins_this_run = min(remaining_pins, random.randint(1, 3))
            return pins_this_run

        # Vƒ∞RAL CONTENT LIBRARY - TEXTLI VERSƒ∞YON
        mega_content_library = {
            "aesthetic_money_shots": {
                "themes": [
                    "hundreds of gold coins cascading like waterfall onto pristine white marble with text 'SAVE MONEY' in bold sans-serif font at bottom center, cinematic lighting, ultra detailed macro photography",
                    "transparent glass piggy bank exploding with rainbow colored bills, text 'START SAVING' in elegant script at top, dramatic motion freeze, professional studio lighting",
                    "luxury wallet overflowing with crisp hundred dollar bills surrounded by fresh white roses and pearls on silk fabric, motivational text 'REACH YOUR DREAMS' in gold lettering foreground",
                    "giant stack of bundled cash creating dramatic tower against moody dark background with text 'FINANCIAL FREEDOM' in white bold font center, dramatic side lighting",
                    "aesthetically arranged colorful cash envelopes in perfect gradient from pink to purple, text 'BUDGET GOALS' in modern typography overlay, overhead flat lay with morning light"
                ],
                "styles": ["hyper-realistic", "cinematic", "magazine-quality"],
                "moods": ["aspirational", "luxurious", "dream-like"]
            },
            
            "viral_piggy_bank_concepts": {
                "themes": [
                    "oversized ceramic piggy bank in millennial pink surrounded by scattered gold coins and eucalyptus leaves with text 'SAVE FOR FUTURE' in clean sans-serif foreground, soft dreamy lighting",
                    "crystal clear glass piggy bank filled with glowing golden coins, text 'MONEY GOALS' in elegant white typography center, magical bokeh lights in background, fairy tale aesthetic",
                    "minimalist white piggy bank on floating shelf with trailing pothos plants, text 'BUILD WEALTH' in modern black font bottom, scandinavian interior aesthetic, natural window light",
                    "vintage brass piggy bank covered in morning dew drops with wildflowers, text 'START TODAY' in rustic script overlay, cottagecore aesthetic, golden hour glow",
                    "modern geometric piggy bank in sage green with gold accents on marble vanity, motivational text 'DREAM BIG' in gold lettering front, luxury lifestyle flat lay"
                ],
                "styles": ["dreamy", "instagram-aesthetic", "pinterest-perfect"],
                "moods": ["cozy", "inspiring", "attainable-luxury"]
            },
            
            "money_jar_magic": {
                "themes": [
                    "mason jar bursting with rolled hundred dollar bills tied with silk ribbon surrounded by fresh lavender and gold jewelry, text 'SAVINGS GOAL' in bold white letters center",
                    "vintage apothecary jar overflowing with international currency notes on antique wooden table, text 'FINANCIAL FREEDOM' in elegant serif font overlay, dramatic chiaroscuro lighting",
                    "crystal clear jar filled with perfectly stacked gold coins creating mesmerizing pattern, text 'EVERY PENNY COUNTS' in modern typography foreground, macro photography, studio lighting",
                    "multiple gradient colored jars labeled for different savings goals aesthetic workspace setup, large text 'ORGANIZE YOUR MONEY' at top, motivational setup",
                    "enormous glass jar filled with colorful bills creating rainbow effect, inspirational text 'REACH YOUR DREAMS' in bold sans-serif bottom, lifestyle photography, bright airy aesthetic"
                ],
                "styles": ["editorial", "lifestyle", "aspirational"],
                "moods": ["motivated", "organized", "goal-oriented"]
            },
            
            "luxury_wealth_visualization": {
                "themes": [
                    "designer handbag spilling with cash and credit cards on marble bathroom counter with candles, text 'LUXURY LIFESTYLE' in elegant gold font center, luxury lifestyle aesthetic",
                    "gold jewelry scattered among hundred dollar bills on velvet cushion, motivational text 'INVEST IN YOURSELF' in white bold letters overlay, dramatic jewelry photography lighting",
                    "luxury car keys on pile of cash with champagne glass, text 'SUCCESS MINDSET' in modern sans-serif foreground, lifestyle goals aesthetic, moody dramatic lighting",
                    "first class plane tickets surrounded by international currency and passport, text 'TRAVEL THE WORLD' in bold white typography center, travel goals flat lay, wanderlust aesthetic",
                    "designer shopping bags filled with tissue paper and cash peeking out, text 'TREAT YOURSELF' in chic script font bottom, luxury retail therapy aesthetic, bright clean lighting"
                ],
                "styles": ["aspirational", "editorial-luxury", "lifestyle-magazine"],
                "moods": ["dreamy", "motivational", "success-driven"]
            },
            
            "coin_stacking_perfection": {
                "themes": [
                    "perfectly symmetrical towers of gleaming coins creating ascending staircase with mirror reflection, text 'BUILD YOUR WEALTH' in bold white font foreground, architectural photography style",
                    "golden coins stacked in fibonacci spiral pattern on black marble, text 'GROW YOUR MONEY' in elegant serif typography center, mathematical beauty, dramatic top lighting",
                    "coins arranged in perfect circular mandala pattern with small succulent in center, text 'FINANCIAL PEACE' in minimal sans-serif bottom, zen aesthetic, natural light",
                    "multiple coin towers of varying heights creating city skyline silhouette at sunset, inspirational text 'REACH HIGHER' in white bold letters overlay, creative conceptual photography",
                    "coins stacked impossibly high defying gravity with small plant growing from top, text 'POSSIBILITIES' in modern typography foreground, whimsical metaphorical photography"
                ],
                "styles": ["artistic", "conceptual", "editorial"],
                "moods": ["satisfying", "ambitious", "growth-focused"]
            },
            
            "plant_money_metaphors": {
                "themes": [
                    "tiny succulent growing from pile of gold coins in terracotta pot, text 'GROW YOUR SAVINGS' in clean sans-serif center, growth metaphor, morning golden hour light",
                    "money tree with actual dollar bills as leaves in modern white ceramic pot, motivational text 'NURTURE WEALTH' in elegant script foreground, whimsical magical realism style",
                    "hand holding small plant with roots wrapped in dollar bills, text 'PLANT YOUR FUTURE' in bold white typography overlay, ethereal dreamy photography, soft backlight",
                    "seedling sprouting from soil made of coins in mason jar, text 'SMALL STEPS BIG DREAMS' in modern font bottom, time-lapse concept, macro photography",
                    "monstera plant with gold painted leaves next to stack of cash, text 'FINANCIAL GROWTH' in minimalist typography center, modern botanical aesthetic, bright natural light"
                ],
                "styles": ["botanical", "metaphorical", "instagram-worthy"],
                "moods": ["hopeful", "nurturing", "growth-mindset"]
            },
            
            "organized_budget_aesthetics": {
                "themes": [
                    "perfectly organized cash envelopes in rainbow gradient with elegant calligraphy labels, text 'BUDGET SMART' in bold modern font top center, overhead flat lay, bright even lighting",
                    "minimalist budget binder open showing colorful dividers and cash slots, text 'GET ORGANIZED' in clean sans-serif foreground, aesthetic stationery setup, soft natural light",
                    "vintage wooden cash box with organized compartments filled with sorted bills and coins, text 'OLD SCHOOL SAVING' in rustic typography overlay, nostalgic aesthetic, warm lighting",
                    "modern acrylic organizer with color-coded cash categories, motivational text 'TAKE CONTROL' in white bold letters center, clean minimalist workspace, scandinavian aesthetic",
                    "aesthetic bullet journal spread with cash envelopes and washi tape decoration, text 'PLAN YOUR MONEY' in elegant script bottom, cozy desk setup, morning light"
                ],
                "styles": ["organized", "aesthetic", "studygram-inspired"],
                "moods": ["satisfying", "motivating", "empowering"]
            },
            
            "cash_lifestyle_goals": {
                "themes": [
                    "stack of hundred dollar bills fanned out on white linen sheets with morning coffee and croissant, text 'WAKE UP WEALTHY' in elegant gold script center, luxury morning aesthetic",
                    "cash spread across marble kitchen island with fresh flowers and laptop, text 'BOSS MODE' in bold white sans-serif foreground, girl boss aesthetic, bright airy photography",
                    "money arranged in heart shape on bed with rose petals, text 'LOVE YOUR MONEY' in romantic script font overlay, romantic wealth visualization, soft dreamy lighting",
                    "bills and coins arranged around open planner and iced coffee, motivational text 'MAKE IT HAPPEN' in modern typography bottom, productive aesthetic, bright desk setup",
                    "cash tucked into designer wallet on vanity with makeup and jewelry, text 'TREAT YOURSELF' in chic gold lettering center, getting-ready aesthetic, glamorous lighting"
                ],
                "styles": ["lifestyle", "relatable-luxury", "aspirational-everyday"],
                "moods": ["inspiring", "achievable", "motivational"]
            },
            
            "minimalist_money_shots": {
                "themes": [
                    "single crisp bill perfectly centered on pure white background with dramatic shadow, text 'SIMPLIFY WEALTH' in minimal black font top, minimalist editorial style",
                    "sleek black leather wallet with single gold credit card visible, text 'LESS IS MORE' in elegant serif typography center, luxury minimalism, hard dramatic lighting",
                    "geometric arrangement of bills and coins creating abstract pattern, text 'MODERN MONEY' in bold sans-serif foreground, modern art photography, high contrast",
                    "one perfect coin standing on edge with infinite white background, text 'BALANCE' in minimal typography bottom, conceptual minimalism, studio lighting",
                    "folded bills creating architectural sculpture, text 'BUILD BETTER' in clean modern font overlay, minimalist still life, museum quality lighting"
                ],
                "styles": ["minimalist", "editorial", "art-photography"],
                "moods": ["sophisticated", "modern", "clean"]
            },
            
            "cozy_savings_moments": {
                "themes": [
                    "hands counting cash at cozy coffee shop table with latte art visible, text 'COFFEE & COUNTING' in warm brown script font center, warm autumn aesthetic, soft natural light",
                    "piggy bank on window sill with rain drops and fairy lights, text 'RAINY DAY FUND' in cozy handwritten style overlay, cozy evening aesthetic, bokeh lighting",
                    "cash envelope system spread on bed with chunky knit blanket, text 'COZY SAVINGS' in soft serif typography bottom, cozy bedroom aesthetic, warm golden light",
                    "vintage tin filled with savings on wooden kitchen table with fresh bread, text 'SIMPLE LIVING' in rustic font foreground, cottagecore aesthetic, rustic lighting",
                    "girl writing in budget journal with cash nearby and candles lit, text 'SELF CARE SAVINGS' in elegant script center, self care aesthetic, cozy evening ambiance"
                ],
                "styles": ["cozy", "lifestyle", "relatable"],
                "moods": ["comforting", "attainable", "wholesome"]
            }
        }

        # ULTRA ENHANCED visual variations
        visual_variations = {
            'color_palettes': [
                'soft blush pink with champagne gold and cream',
                'sage green with natural wood and white marble',
                'deep navy with rose gold and ivory',
                'millennial pink with grey marble and brass',
                'warm terracotta with olive green and beige',
                'powder blue with silver and soft white',
                'lavender with gold and pearl white',
                'emerald green with gold leaf and cream',
                'peachy coral with copper and linen white',
                'dusty rose with antique gold and alabaster'
            ],
            
            'lighting_styles': [
                'golden hour warm glow streaming through sheer curtains',
                'soft diffused morning light with slight haze',
                'dramatic side lighting creating long elegant shadows',
                'bright airy natural light with slight overexposure',
                'moody chiaroscuro with spotlight effect',
                'backlit with glowing rim light and bokeh',
                'even studio lighting with soft shadows',
                'sunset glow with warm orange tones',
                'dreamy fairy lights creating magical bokeh',
                'crisp daylight with perfect white balance'
            ],
            
            'compositions': [
                'rule of thirds with leading lines to focal point',
                'perfectly centered symmetrical composition',
                'dynamic diagonal arrangement creating movement',
                'flat lay from directly above with geometric precision',
                'slight overhead angle showing beautiful depth and layers',
                'close-up macro showing intricate details',
                'negative space emphasizing minimalism',
                'frame within frame creating depth',
                'golden ratio spiral composition',
                'balanced asymmetry creating visual interest'
            ],
            
            'textures': [
                'smooth polished marble with natural veining',
                'warm rustic reclaimed wood with character',
                'soft luxury linen fabric with subtle wrinkles',
                'pristine white backdrop with slight texture',
                'natural stone with organic patterns',
                'sleek modern concrete surface',
                'plush velvet with rich depth',
                'weathered vintage wood with patina',
                'smooth ceramic with matte finish',
                'brushed metal with subtle reflections'
            ],
            
            'pinterest_boost_keywords': [
                'pinterest aesthetic perfection',
                'viral worthy composition',
                'high engagement visual',
                'scroll-stopping imagery',
                'save-worthy content',
                'repinnable masterpiece',
                'trending aesthetic 2025',
                'algorithm-friendly composition',
                'maximum visual appeal',
                'instant attention grabber'
            ]
        }

        # CRITICAL: Quality ve viral factors
        quality_enhancers = [
            'professional editorial photography',
            'ultra high resolution 8k sharp focus',
            'magazine cover worthy quality',
            'pinterest trending aesthetic',
            'viral social media worthy',
            'shot on expensive camera',
            'professional color grading',
            'perfect exposure and white balance',
            'tack sharp focus throughout',
            'studio photography quality'
        ]

        # TEXT ƒ∞√áERMELƒ∞ - Motivasyonel mesajlar g√∂rsel i√ßinde yer almalƒ±
        text_integration_rules = [
            'text overlay prominently displayed in foreground',
            'bold readable typography integrated into composition',
            'motivational text clearly visible as main element',
            'text placement strategic and eye-catching',
            'typography professionally designed as part of image',
            'text should be focal point with high contrast',
            'ensure text is sharp and perfectly legible'
        ]

        def generate_unique_prompt():
            category = random.choice(list(mega_content_library.keys()))
            content = mega_content_library[category]
            theme = random.choice(content['themes'])
            color = random.choice(visual_variations['color_palettes'])
            lighting = random.choice(visual_variations['lighting_styles'])
            composition = random.choice(visual_variations['compositions'])
            texture = random.choice(visual_variations['textures'])
            style = random.choice(content['styles'])
            mood = random.choice(content['moods'])
            
            quality = random.choice(quality_enhancers)
            pinterest_boost = random.choice(visual_variations['pinterest_boost_keywords'])
            text_rule = random.choice(text_integration_rules)
            
            # MEGA PROMPT - TEXT G√ñR√úN√úR OLMALI
            prompt = f"{theme}, {color}, {lighting}, {composition}, {texture}, {style} style, {mood} mood, {quality}, {pinterest_boost}, vertical pinterest format 2:3 ratio, {text_rule}, professional typography design"
            
            return prompt, category

        def generate_unique_content(category):
            # √áe≈üitli ba≈ülƒ±klar
            titles = [
                "Money Saving Tip üí∞",
                "Financial Freedom ‚ú®",
                "Savings Goal üéØ",
                "Smart Money üí°",
                "Budget Goals üåü",
                "Wealth Building üìà",
                "Save Money üíö",
                "Financial Wellness ‚òòÔ∏è",
                "Money Matters üíµ",
                "Financial Success üèÜ",
                "Saving Strategy üß†",
                "Money Management üìä"
            ]
            
            # Daha uzun ve √ße≈üitli a√ßƒ±klamalar
            intros = [
                "üí≠ Quick tip:",
                "‚ú® Did you know?",
                "üéØ Pro tip:",
                "üí° Money wisdom:",
                "üåü Remember:",
                "üìà Success tip:",
                "üíö Daily reminder:",
                "‚ö° Financial hack:"
            ]
            
            bodies = [
                "Every small amount you save today builds your financial security for tomorrow.",
                "Consistency in saving beats perfection every single time - start with what you can.",
                "Your savings account isn't just money, it's your peace of mind and future opportunities.",
                "The secret to building wealth? Small daily habits that compound over time.",
                "Saving money isn't about restriction, it's about creating the life you want.",
                "Financial freedom starts with the decision to save even when it feels small.",
                "Every dollar saved is a vote for your future self and your dreams.",
                "Building wealth is a marathon, not a sprint - celebrate every small win.",
                "Your financial journey is unique - compare yourself only to your past self.",
                "Smart money management today creates endless possibilities tomorrow.",
                "Saving is self-care for your future - you deserve financial stability.",
                "Small sacrifices today lead to big celebrations in your future."
            ]
            
            ctas = [
                "What's your savings goal?",
                "Start your journey today!",
                "Double tap if saving!",
                "Share this with a friend",
                "Follow for more tips",
                "Comment your goal below",
                "Save this for later",
                "Tag someone who needs this"
            ]
            
            hashtags_list = [
                "#moneysavingtips #financialfreedom #budgeting #personalfinance",
                "#savingmoney #financialliteracy #moneygoals #wealthbuilding",
                "#financetips #moneymindset #savingsgoals #smartmoney",
                "#budgetingtips #financialwellness #moneytips #savingsplan",
                "#moneymanagement #financialsuccess #savingsmotivation #moneymatters",
                "#financialindependence #moneysaver #budgetlife #wealthmindset"
            ]
            
            title = random.choice(titles)
            intro = random.choice(intros)
            body = random.choice(bodies)
            cta = random.choice(ctas)
            hashtags = random.choice(hashtags_list)
            
            # Uzun description (link + hashtag dahil)
            description = f"{intro} {body} {cta}\n\nüíª More tips: {WEBSITE_URL}\n\n{hashtags}"
            
            return title, description

        def create_diverse_image(prompt):
            encoded = urllib.parse.quote(prompt)
            timestamp = int(datetime.now().timestamp() * 1000)
            
            # √áOK DAHA FAZLA rastgelelik i√ßin:
            random_component = random.randint(100000, 999999999)
            noise_factor = random.randint(1, 1000000)
            micro_timestamp = int(datetime.now().microsecond)
            
            prompt_hash = abs(hash(prompt + str(random_component)))
            
            # Mega seed kombinasyonu - her √ßalƒ±≈ütƒ±rmada farklƒ±
            super_seed = (timestamp * random_component + noise_factor + micro_timestamp + prompt_hash) % 2147483647
            
            # Daha fazla boyut √ße≈üitliliƒüi
            size = random.choice([
                (1000, 1500), (1080, 1620), (1000, 1400),
                (1080, 1350), (1000, 1600), (1200, 1800),
                (800, 1200), (900, 1350), (1000, 1250)
            ])
            
            # Model parametresi ile (flux modelleri text'e daha iyi)
            model = random.choice(['flux', 'flux-realism', 'flux-pro'])
            
            image_url = f"https://image.pollinations.ai/prompt/{encoded}?width={size[0]}&height={size[1]}&seed={super_seed}&nologo=true&enhance=true&model={model}"
            
            return image_url, super_seed

        def send_to_pinterest(image_url, title, description):
            event_name = IFTTT_EVENT
            ifttt_url = f"https://maker.ifttt.com/trigger/{event_name}/with/key/{IFTTT_KEY}"
            payload = {
                "value1": image_url,
                "value2": title,
                "value3": description
            }
            
            for attempt in range(4):
                try:
                    r = session.post(ifttt_url, json=payload, timeout=20)
                    if r.status_code == 200:
                        return True
                    text = (r.text or '').lower()
                    if 'limit' in text or r.status_code in (429, 503):
                        sleep = (2 ** attempt) + random.random()
                        print(f"‚ö†Ô∏è IFTTT rate or service issue (status {r.status_code}). Backing off {sleep:.1f}s")
                        time.sleep(sleep)
                        continue
                    print(f"‚ùå IFTTT HTTP {r.status_code}: {r.text[:200]}")
                    return False
                except requests.RequestException as e:
                    sleep = (2 ** attempt) + random.random()
                    print(f"‚ö†Ô∏è Network error -> {e}. Retrying in {sleep:.1f}s")
                    time.sleep(sleep)
            return False

        def log_pin(entry):
            LOG_FILE = STATE_DIR / 'run.log'
            try:
                with open(LOG_FILE, 'a') as f:
                    f.write(json.dumps(entry) + '\n')
            except Exception as e:
                print(f"‚ö†Ô∏è Log write failed: {e}")

        def smart_posting_system():
            posted = load_posted()
            pins_to_post = calculate_safe_pin_count()
            if pins_to_post == 0:
                print('üìå Bug√ºnl√ºk limit dolu veya 0 pin. √áƒ±kƒ±lƒ±yor.')
                # Bo≈ü dosya olu≈ütur ki artifact upload ba≈üarƒ±lƒ± olsun
                (STATE_DIR / 'no_pins_posted.txt').write_text(f"No pins posted at {datetime.now().isoformat()}")
                return
            print(f"üéØ Bu √ßalƒ±≈ütƒ±rmada payla≈üƒ±lacak pin sayƒ±sƒ±: {pins_to_post}")
            
            for i in range(pins_to_post):
                if i > 0:
                    wait_time = random.uniform(3, 12)
                    print(f"‚è≥ {wait_time:.1f}s bekleniyor")
                    time.sleep(wait_time)
                
                attempt = 0
                prompt = None
                while attempt < 8:
                    prompt, category = generate_unique_prompt()
                    checksum = str(abs(hash(prompt)))
                    if checksum not in posted:
                        posted.add(checksum)
                        break
                    attempt += 1
                
                if not prompt:
                    print('üîÅ Benzersiz prompt bulunamadƒ±, atlanƒ±yor.')
                    continue
                
                print(f"üìÇ Kategori: {category} | Prompt checksum: {checksum[:8]}")
                image_url, seed = create_diverse_image(prompt)
                title, description = generate_unique_content(category)
                
                success = send_to_pinterest(image_url, title, description)
                entry = {"timestamp": datetime.now().isoformat(), "category": category, "seed": seed, "success": success}
                log_pin(entry)
                
                print(f"‚úÖ Pin {'ba≈üarƒ±lƒ±' if success else 'ba≈üarƒ±sƒ±z'}: {title}")
            
            save_posted(posted)
            
            # Summary dosyasƒ± olu≈ütur
            summary = {
                "run_time": datetime.now().isoformat(),
                "pins_posted": pins_to_post,
                "total_tracked": len(posted)
            }
            (STATE_DIR / 'summary.json').write_text(json.dumps(summary, indent=2))

        def main():
            print('=== PINTEREST VIRAL TEXT CONTENT ENGINE ===')
            print(datetime.now().isoformat())
            smart_posting_system()
            print('=== ƒ∞≈ûLEM TAMAMLANDI ===')

        if __name__ == '__main__':
            main()
        PY

    - name: Upload logs & state as artifact
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: pinterest-state-and-logs
        path: .pinterest_state/
        if-no-files-found: warn

    - name: Summary Report
      if: success()
      run: |
        echo "================================"
        echo "üìä PINTEREST VIRAL AUTOMATION REPORT"
        echo "================================"
        echo "‚úÖ G√∂rev tamamlandƒ±"
        echo "üí∞ Tasarruf temalƒ± i√ßerikler olu≈üturuldu"
        echo "‚úçÔ∏è Motivasyonel textli g√∂rseller"
        echo "üìà Hesap saƒülƒ±ƒüƒ± korunuyor"
        echo "üî• Viral potansiyeli y√ºksek"
        echo "================================"
        if [ -f .pinterest_state/summary.json ]; then
          echo "üìÑ Run Summary:"
          cat .pinterest_state/summary.json
        fi

    - name: Failure report
      if: failure()
      run: |
        echo "================================"
        echo "‚ùå PINTEREST AUTOMATION FAILURE"
        echo "Check artifacts: pinterest-state-and-logs"
        echo "================================"
